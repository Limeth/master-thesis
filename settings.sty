\ProvidesPackage{settings}

\usepackage{mathtools}
\usepackage{siunitx}
\usepackage{ifthen}
\usepackage{datatool}
\usepackage{longtable}
\usepackage{tabularx}
\usepackage{makecell}
\usepackage{colortbl}
\usepackage{multirow}

\usepackage{ctu/ctu}

% footnote URLs
\newcommand\fref[2]{%
  \href{#1}{#2}\footnote{\url{#1}}%
}

% acronyms with Extra info
\newcommand\ace[2]{%
    \aclu{#1} (\acs{#1}\acused{#1}; #2)%
}
\newcommand\Ace[2]{%
    \Acl{#1} (\acs{#1}\acused{#1}; #2)%
}
\newcommand\acep[2]{%
    \aclp{#1} (\acsp{#1}\acused{#1}; #2)%
}
\newcommand\Acep[2]{%
    \Aclp{#1} (\acsp{#1}\acused{#1}; #2)%
}

% FONT SETTINGS
% source: https://github.com/sarabander/sicp-pdf/blob/master/src/preamble.tex
\usepackage[T1]{fontenc}
% \usepackage[no-math]{fontspec}

% Monospace Font
\defaultfontfeatures{Scale=MatchLowercase}
\setmonofont[Path = fonts/]{iosevka-regular}

% Serif Font
\defaultfontfeatures{%
    Scale=MatchLowercase,
    Mapping=tex-text,
    SmallCapsFeatures={LetterSpace=2.5, WordSpace=1.05},
}
\setmainfont{Linux Libertine O}

% Sans-Serif Font
\setsansfont{Source Serif Pro}


% LANGUAGE SETTINGS
% source: https://github.com/sarabander/sicp-pdf/blob/master/src/preamble.tex
\usepackage{polyglossia}
\setdefaultlanguage[variant=american]{english}
\setotherlanguages{greek, dutch}

% FLOAT TITLES
\usepackage[titles]{tocloft}
\newlistof{listing}{lol}{Listings}
\renewcommand{\cftfigpresnum}{Figure~}
\renewcommand{\cftlistingpresnum}{Listing~}
\setlength{\cftfigindent}{0pt}
\setlength{\cftfignumwidth}{2.5cm}
\setlength{\cftlistingnumwidth}{2.5cm}
\let\counterwithout\relax
\let\counterwithin\relax
\usepackage{chngcntr}
\usepackage[labelfont=bf]{caption}

% PACKAGES
\usepackage{pdfpages}
\usepackage{graphicx}
\usepackage{subfig}
\usepackage{copyrightbox}
\usepackage{listings}
\usepackage[newfloat,outputdir=build]{minted}
\usepackage{parskip}
\usepackage[backend=biber,natbib,hyperref=true,authordate]{biblatex-chicago}
% \usepackage[backend=biber,natbib,hyperref=true]{biblatex}
\usepackage{float}
\usepackage{tocbasic}
\usepackage{url}
\urlstyle{same}
\usepackage[breaklinks]{hyperref}
\usepackage[dvipsnames]{xcolor}

\usepackage{pgfplots}
\usepackage{pgfplotstable}
\pgfplotsset{compat=1.16}
\usetikzlibrary{matrix,shapes,arrows,positioning,fit,trees,decorations.pathreplacing,calc}
\usepgfplotslibrary{fillbetween}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{stmaryrd}
\usepackage{csquotes}
\usepackage[top=2.5cm, bottom=3.5cm, left=3.5cm, right=3.5cm, headheight=110pt]{geometry}
\usepackage{microtype}
% \usepackage[printonlyused,withpage]{acronym}
\usepackage{acronym}
\usepackage{ragged2e}
\usepackage{wrapfig}
\usepackage{needspace}

\def\subsubsubsection#1{\paragraph{#1}}

%%%%
% Floating point evaluation using \fpeval
%
% Provide the command \fpeval as a copy of the code-level \fp_eval:n.
\usepackage{expl3}[2012-07-08]
\ExplSyntaxOn
\cs_new_eq:NN \fpeval \fp_eval:n
\ExplSyntaxOff
%%%%

\definecolor{darkgray}{gray}{0.25}
\definecolor{ao}{rgb}{0.0, 0.5, 0.0}
\definecolor{cardinal}{rgb}{0.77, 0.12, 0.23}

\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}

% \renewcommand{\chaptermark}[1]{\markboth{\MakeUppercase{\chaptername\ \thechapter.\ #1}}{}}
\renewcommand{\headrulewidth}{0pt}

\fancyhead[RE]{{\small \color{darkgray} \textmd{\textsf{\leftmark}}}}
\fancyhead[LO]{{\small \color{darkgray} \textmd{\textsf{\rightmark}}}}
\fancyhead[LE,RO]{{\color{darkgray} \textmd{\textsf{\thepage}}}}

\fancypagestyle{plain}{%
    \fancyhf{}%
    \fancyhead[RE]{{\small \color{darkgray} \textmd{\textsf{\leftmark}}}}
    \fancyhead[LO]{{\small \color{darkgray} \textmd{\textsf{\rightmark}}}}
    \fancyhead[LE,RO]{{\color{darkgray} \textmd{\textsf{\thepage}}}}
}

\renewcommand\@makefntext[1]{%
    \parindent 1em%
    \noindent
    \color{darkgray}
    \hb@xt@1.8em{\hss\@makefnmark}#1}

\usepackage{titlesec}
\definecolor{gray75}{gray}{0.75}
\newcommand{\hsp}{\hspace{20pt}}
\titleformat{\chapter}[hang]{\Huge\bfseries}{%
    \thechapter\hsp\textcolor{gray75}{|}\hsp}
{0pt}{\Huge\bfseries}

% MINTED SETTINGS
\usemintedstyle{friendly}
\RecustomVerbatimEnvironment{Verbatim}{BVerbatim}{}

\usepackage{minitoc}
\setlength{\mtcindent}{38pt}
\mtcsetrules{*}{off}


\usepackage[algochapter, ruled, lined, commentsnumbered, longend]{algorithm2e}
\SetAlgorithmName{Specification}{Specification}{List of Specifications}
\SetAlgoProcName{Procedure}{\hspace*{-1.5mm}}

% Keywords
\SetKw{KwState}{state}
\SetKw{KwUpdate}{update}
\SetKw{KwSource}{atSource}
\SetKw{KwDown}{downstream}
\SetKw{KwLet}{let}
\SetKw{KwQuery}{query}


\usepackage{amsthm}
\theoremstyle{plain}
\newtheorem{lemma}{Lemma}[chapter]
\newtheorem{theorem}{Theorem}[chapter]
\newtheorem{property}{Property}[chapter]
\newtheorem{corollary}{Corollary}[chapter]

\theoremstyle{definition}
\newtheorem{definition}{Definition}[chapter]
\newtheorem{example}{Example}[chapter]


\usepackage[nameinlink]{cleveref}

\crefname{def}{definition}{definition}
\Crefname{def}{Definition}{Definition}
\crefname{thm}{theorem}{theorem}
\Crefname{thm}{Theorem}{Theorem}
\crefname{lem}{lemma}{lemma}
\crefname{lem}{Lemma}{Lemma}
\crefname{cor}{corollary}{corollary}
\crefname{cor}{Corollary}{Corollary}
\crefname{exm}{example}{example}
\Crefname{exm}{Example}{Example}

\crefname{property}{property}{properties}
\Crefname{property}{Property}{Properties}

\makeatletter
\AtEveryBibitem{\global\undef\bbx@lasthash}
\makeatother

% Check if a string contains a character, e.g.:
%\if\instring{a}{abcdef}\message{YES}\else\message{NO}\fi
\makeatletter
\def\instring#1#2{TT\fi\begingroup
  \edef\x{\endgroup\noexpand\in@{#1}{#2}}\x\ifin@}
\makeatother

% vertically-centered tilde ~
\def\tildec {\char`~}

% signed quote
\def\signed #1{{\leavevmode\unskip\nobreak\hfil\penalty50\hskip2em
  \hbox{}\nobreak\hfil#1%
  \parfillskip=0pt \finalhyphendemerits=0 \endgraf}}

\newsavebox\mybox
\newenvironment{aquote}[1]
  {\savebox\mybox{#1}\begin{quote}}
  {\signed{\usebox\mybox}\end{quote}}

% section numbering depth
\setcounter{secnumdepth}{5}
\setcounter{tocdepth}{4}
\setcounter{minitocdepth}{5}

% license info for reused images
\DeclareRobustCommand\cctext[5]{%
    \lowercase{\def\lowercaselicense{#2}}%
    \uppercase{\def\uppercaselicense{#2}}%
    #4 ``#5'' released by \textcite{#1} under the {\href{https://creativecommons.org/licenses/\lowercaselicense/#3/}{CC \uppercaselicense\ #3}} license. ©~\textcite{#1}.
}

\DeclareRobustCommand\cczerotext[1]{%
    Released by #1 under the {\href{https://creativecommons.org/publicdomain/zero/1.0/}{CC0 1.0}} (public domain) license.
}

\DeclareRobustCommand\crtext[1]{%
    ©~\textcite{#1}, permission for use granted by the authors.
}

\DeclareRobustCommand\ccfootnote[5]{%
    \footnote{\cctext{#1}{#2}{#3}{#4}{#5}}%
}

\DeclareRobustCommand\cczerofootnote[1]{%
    \footnote{\cczerotext{#1}}%
}

\DeclareRobustCommand\crfootnote[1]{%
    \footnote{\crtext{#1}}%
}

% Some black magic by Phelype Oleinik to get footnotes to work in subfigures: https://tex.stackexchange.com/questions/414185/real-footnote-with-subcaption-package#comment1536965_414191
\usepackage{etoolbox}
\makeatletter
\def\atendfigurenotes{}
\AfterEndEnvironment{figure}{\atendfigurenotes\let\atendfigurenotes\@empty}%
\makeatother
\AtBeginEnvironment{figure}{\DeclareRobustCommand\footnote[1]{\footnotemark\xdef\atendfigurenotes{\unexpanded\expandafter{\atendfigurenotes}\noexpand\setcounter{footnote}{\thefootnote}\noexpand\footnotetext\unexpanded{{#1}}}}}
